(()=>{var t,e;window.TastyRecipes=window.TastyRecipes||{},window.TastyRecipes.smoothScroll={init(){document.addEventListener("click",t=>{let e=t.target;if("A"!==e.tagName&&(e=e.closest("a.tasty-recipes-scrollto")),!e||!e.classList.contains("tasty-recipes-scrollto"))return;const i=e.getAttribute("href");i&&(t.preventDefault(),this.goToSelector(i))})},goToSelector(t){const e=document.querySelector(t);e&&e.scrollIntoView({behavior:"smooth"})}},document.addEventListener("DOMContentLoaded",()=>window.TastyRecipes.smoothScroll.init()),window.TastyRecipes=window.TastyRecipes||{},window.TastyRecipes.staticTooltip={element:null,tooltipElement:null,deleting:!1,init(t){this.deleting||(this.element=t,this.buildElements())},destroy(){this.tooltipElement&&!this.deleting&&(this.deleting=!0,this.tooltipElement.classList.remove("opened"),setTimeout(()=>{this.tooltipElement.remove(),this.deleting=!1},500))},buildElements(){const t=document.createElement("div");t.classList.add("tasty-recipes-static-tooltip"),t.setAttribute("id","tasty-recipes-tooltip");const e=document.getElementById("tasty-recipes-tooltip");e?document.body.replaceChild(t,e):document.body.appendChild(t),this.tooltipElement=document.getElementById("tasty-recipes-tooltip")},show(){if(!this.tooltipElement)return;const t=this.element.getBoundingClientRect().top+window.scrollY-10-this.tooltipElement.getBoundingClientRect().height,e=this.element.getBoundingClientRect().left-this.tooltipElement.getBoundingClientRect().width/2+this.element.getBoundingClientRect().width/2-1,i=Math.max(10,e);this.maybeRemoveTail(i!==e),this.tooltipElement.setAttribute("style","top:"+t+"px;left:"+i+"px;"),this.tooltipElement.classList.add("opened")},maybeRemoveTail(t){t?this.tooltipElement.classList.add("tr-hide-tail"):this.tooltipElement.classList.remove("tr-hide-tail")},changeMessage(t){this.tooltipElement&&(this.tooltipElement.innerHTML=t)}},window.TastyRecipes.ajax={sendPostRequest(t,e,i,s){const a=new XMLHttpRequest;a.open("POST",t,!0),a.send(this.preparePostData(e)),a.onreadystatechange=()=>{4===a.readyState&&(200!==a.status?s(a):i(JSON.parse(a.responseText)))},a.onerror=()=>{s(a)}},preparePostData(t){const e=new FormData;for(const i in t)e.append(i,t[i]);return e}},window.TastyRecipes.ratings={defaultRating:0,currentRatingPercentage:100,savingRating:!1,init(t){this.minRating=t,this.formWatchRating(),this.closeTooltipWhenClickOutside(),this.addBodyClassBasedOnSelectedRating(),this.backwardCompFormRatingPosition()},formWatchRating(){const t=document.querySelectorAll(".tasty-recipes-no-ratings-buttons [data-rating]");if(!(t.length<=0))for(const e of t)e.addEventListener("click",t=>{t.preventDefault(),this.defaultRating=t.target.closest(".checked").dataset.rating,this.setCheckedStar(t.target),this.maybeSendRating(this.defaultRating,t.target),this.setRatingInForm(this.defaultRating)})},closeTooltipWhenClickOutside(){window.addEventListener("click",t=>{t.target.closest(".tasty-recipes-rating")||t.target.classList.contains("tasty-recipes-static-tooltip")||window.TastyRecipes.staticTooltip.destroy()})},setRatingInForm(t){const e=document.querySelector('#respond .tasty-recipes-rating[value="'+t+'"]');e&&e.click()},addBodyClassBasedOnSelectedRating(){const t=document.querySelectorAll("input.tasty-recipes-rating");if(t)for(const e of t)e.addEventListener("click",t=>{const e=t.target.getAttribute("value");this.handleBodyClassByRating(e),this.toggleCommentTextareaRequired(e)})},handleBodyClassByRating(t){t<this.minRating?document.body.classList.remove("tasty-recipes-selected-minimum-rating"):document.body.classList.add("tasty-recipes-selected-minimum-rating")},toggleCommentTextareaRequired(t){const e=document.getElementById("comment");e&&(t<this.minRating?e.setAttribute("required",""):e.removeAttribute("required"))},maybeSendRating(t,e){if(this.savingRating===t)return;this.savingRating=t,window.TastyRecipes.staticTooltip.init(e);const i=e.closest(".tasty-recipes");i?window.TastyRecipes.ajax.sendPostRequest(window.trCommon.ajaxurl,{action:"tasty_recipes_save_rating",rating:t,nonce:window.trCommon.ratingNonce,post_id:window.trCommon.postId,recipe_id:i.dataset.trId},e=>{window.TastyRecipes.staticTooltip.changeMessage(e.data.message),window.TastyRecipes.staticTooltip.show(),this.updateAverageText(e.data,i),this.maybeFillCommentForm(e.data),setTimeout(()=>{this.maybeResetTooltip(i,e.data,t)},5e3)},()=>{this.resetTooltip(i)}):window.TastyRecipes.staticTooltip.destroy()},updateAverageText(t,e){if(!t.average)return;if(this.setRatingPercent(t),!t.count)return;const i=document.querySelector(".tasty-recipes-rating-link");i&&(this.setTextInContainer(i,t),this.setPartialStar(i)),e.querySelector(".tasty-recipes-ratings-buttons").dataset.trDefaultRating=t.average,this.setTextInContainer(e.querySelector(".tasty-recipes-rating"),t)},setTextInContainer(t,e){if(!t)return;if(e.label){const i=t.querySelector(".rating-label");return void(i&&(i.innerHTML=e.label))}const i=t.querySelector(".average");i&&(i.textContent=e.average);const s=t.querySelector(".count");s&&(s.textContent=e.count)},setPartialStar(t){const e=t.querySelector('[data-rating="'+Math.ceil(this.defaultRating)+'"]');e&&(e.dataset.trClip=this.currentRatingPercentage)},setRatingPercent(t){this.defaultRating=t.average.toFixed(1);const e=t.average.toFixed(2).toString().split(".");this.currentRatingPercentage=e[1]?e[1]:100,"00"===this.currentRatingPercentage&&(this.currentRatingPercentage=100)},setCheckedStar(t){const e=t.closest(".tasty-recipes-ratings-buttons").querySelector("[data-tr-checked]");e&&delete e.dataset.trChecked;const i=t.closest(".tasty-recipes-rating");i.dataset.trChecked=1,i.querySelector("[data-tr-clip]").dataset.trClip=100},maybeFillCommentForm(t){if(!t.comment||!t.comment.content)return;const e=document.querySelector("#commentform");if(!e)return;const i=e.querySelector("[name=comment]");i&&!i.value&&(i.innerHTML=t.comment.content,t.comment.name&&(e.querySelector("[name=author]").value=t.comment.name,e.querySelector("[name=email]").value=t.comment.email))},maybeResetTooltip(t,e,i){this.savingRating===i&&this.resetTooltip(t,e)},resetTooltip(t,e){window.TastyRecipes.staticTooltip.destroy(),this.savingRating=!1;const i=t.querySelector(".tasty-recipes-ratings-buttons");i&&(this.defaultRating=e&&e.average?e.average.toFixed(1):i.dataset.trDefaultRating,i.dataset.trDefaultRating=this.defaultRating,this.resetSelectedStar(i,e))},resetSelectedStar(t){const e=t.querySelector('[data-rating="'+Math.ceil(this.defaultRating)+'"]');e&&(e.querySelector("[data-tr-clip]").dataset.trClip=this.currentRatingPercentage,e.parentNode.dataset.trChecked=1);const i=t.querySelector("[data-tr-checked]");i&&i.querySelector("[data-rating]")!==e&&delete i.dataset.trChecked},backwardCompFormRatingPosition(){const t=document.querySelector("#respond .tasty-recipes-ratings-buttons, #tasty-recipes-comment-rating .tasty-recipes-ratings-buttons");if(!t)return;window.getComputedStyle(t).display.includes("flex")||(t.style.direction="rtl"),"undefined"!=typeof tastyRecipesRating&&(t.querySelector('.tasty-recipes-rating[value="'+tastyRecipesRating+'"]').checked=!0);const e=t.querySelectorAll(".tasty-recipes-rating");for(const t of e)t.addEventListener("click",e=>{t!==e.target&&t.previousElementSibling.click()})}},t=()=>{window.TastyRecipes.ratings.init(window.trCommon?window.trCommon.minRating:6)},"loading"!==document.readyState?t():window.addEventListener("load",t),(e=document.querySelectorAll('button[name="tasty-recipes-video-toggle"]'))&&e.forEach(function(t){t.addEventListener("click",function(e){var i=e.target.closest(".tasty-recipes-instructions");if(i||(i=e.target.closest(".tasty-recipe-instructions")),i){var s="true"===t.getAttribute("aria-checked");t.setAttribute("aria-checked",s?"false":"true"),s?i.classList.add("tasty-recipes-hide-video"):i.classList.remove("tasty-recipes-hide-video")}})})})();